class Client {
    url;
    constructor(url) {
        this.url = url;
    }
    async request(...args) {
        const requests = [];
        if (args.length == 2) {
            push(requests, args[0], args[1]);
            const [value] = await send(this.url, requests);
            return value;
        }
        else {
            for (let i = 0; i < args.length >> 1; i++)
                push(requests, args[i << 1], args[2 * i + 1]);
            return send(this.url, requests);
        }
    }
}
function push(requests, method, params) {
    requests.push({ method, params });
}
function _4e4030_(errors, response) {
    if (!("error" in response))
        return;
    const { code, message, data } = response.error;
    const error = new Error(`${code}: ${message}`);
    if (data)
        error.cause = data;
    errors.push(error);
}
async function send(url, requests) {
    const _02_ = new Array(requests.length);
    for (let i = 0; i < requests.length; i++) {
        _02_[i] = requests[i];
        _02_[i].jsonrpc = "2.0";
        _02_[i].id = i;
    }
    const headers = { "Content-Type": "application/json" };
    const body = JSON.stringify(requests.length == 1 ? _02_[0] : _02_);
    const response = await fetch(url, { method: "POST", headers, body });
    const json = await response.json();
    const errors = new Array();
    if (_02_.length == 1) {
        _4e4030_(errors, json);
        _02_[0] = json.result;
    }
    else {
        for (let i = 0; i < _02_.length; i++) {
            const request = json.find((_fc_) => _fc_.id == i);
            if (request === undefined) {
                const code = -32000;
                const message = `response missing for request ${i}`;
                const error = new Error(`${code}: ${message}`);
                errors.push(error);
                continue;
            }
            _4e4030_(errors, request);
            _02_[i] = request.result;
        }
    }
    if (errors.length)
        throw new AggregateError(errors);
    return _02_;
}
export { Client };
